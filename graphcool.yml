types: ./types.graphql

permissions:
  - operation: '*'
  # - operation: Basket.read
  #   authenticated: false
  # - operation: Basket.create
  # - operation: Basket.update
  # - operation: Basket.delete
  #   authenticated: true
  #   # query: ./permissions/Basket.graphql
  #
  # - operation: BasketItem.read
  #   authenticated: false
  # - operation: BasketItem.create
  # - operation: BasketItem.update
  # - operation: BasketItem.delete
  #   authenticated: true
  #   # query: ./permissions/BasketItem.graphql
  #
  # - operation: addItemToBasket
  #   authenticated: true
  #   # query: ./permissions/addItemToBasket.graphql
  #
  # - operation: Order.read
  #   authenticated: true
  #   # query: ./permissions/Order.graphql
  #
  # - operation: Checkout
  #   authenticated: false
  #   # query: ./permissions/Checkout.graphql

rootTokens:
  - defaultToken

functions:
  addItemToBasket:
    handler:
      code:
        src: ./src/addItemToBasket.js
    type: resolver
    schema: ./src/addItemToBasket.graphql

  getBasketSubTotal:
    handler:
      code:
        src: ./src/getBasketSubTotal.js
    type: resolver
    schema: ./src/getBasketSubTotal.graphql

  Checkout:
    handler:
      code:
        src: ./src/Checkout.js
        environment:
          STRIPE_KEY: ${env:STRIPE_KEY}
    type: resolver
    schema: ./src/Checkout.graphql

  sendOrderConfirmationEmail:
    handler:
      code:
        src: ./src/sendOrderEmail.js
        environment:
          SENDGRID_API_KEY: ${env:SENDGRID_API_KEY}
    type: subscription
    query: ./src/sendOrderEmail.graphql

  cleanupCarts:
    handler:
      code:
        src: ./src/cleanupCarts.js
    type: subscription
    query: ./src/cleanupCarts.graphql

  sendShippingConfirmationEmail:
    handler:
      code:
        src: ./src/sendShippingEmail.js
        environment:
          SENDGRID_API_KEY: ${env:SENDGRID_API_KEY}
          STORE_NAME: ${env:STORE_NAME}
          STORE_EMAIL: ${env:STORE_EMAIL}
    type: subscription
    query: ./src/sendShippingEmail.graphql
